{"uid":"b9e9a5e927509a56","name":"Получаем ошибку 429.","fullName":"tests.test_chat_completions.TestChatCompletions#test_too_many_requests","historyId":"916d6d2c0ee814e0427fae8e1c9ca84f","time":{"start":1761333247727,"stop":1761333329067,"duration":81340},"status":"failed","statusMessage":"AssertionError: assert 200 == 429\n +  where 200 = <Response [200]>.status_code\n +  and   429 = ResponseCodes.too_many_requests","statusTrace":"self = <test_chat_completions.TestChatCompletions object at 0x0000021017422C50>\ntoken = 'eyJjdHkiOiJqd3QiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwiYWxnIjoiUlNBLU9BRVAtMjU2In0.DVdan-pSjNVHU09tBQ10KS3wxagR3aI7XP-fDm7bO...w_EBc1IrLoIIeAfZ4IwKzs4nYEVBDH8Mjw2zn8ucTJvU7Nbh1kGQbcEPJUd7BwCdqajahH39mw.xeqvBqC6U6RINPR59Ba2NoN_xxsZh-TuuVrufs5EgQk'\n\n    @allure.title('Получаем ошибку 429.')\n    def test_too_many_requests(self, token):\n        url = main_url + completions\n        data = json.dumps({\n            \"model\": RequestData.model,\n            \"messages\": [\n                {\n                \"role\": RequestData.role,\n                \"content\": RequestData.content\n                }\n            ],\n            \"temperature\": RequestData.temperature,\n            \"top_p\": RequestData.top_p,\n            \"stream\": RequestData.stream,\n            \"max_tokens\": RequestData.max_tokens,\n            \"repetition_penalty\": RequestData.repetition_penalty,\n            \"update_interval\": RequestData.update_interval\n        })\n        headers = {\n            'X-Client-ID': RequestData.x_client,\n            'X-Request-ID': RequestData.x_request,\n            'X-Session-ID': RequestData.x_session,\n            'Content-Type': RequestData.content_type,\n            'Authorization': \"Bearer \" + token\n            }\n    \n        i = 0\n        with allure.step(f'POST запрос к {url} с данными {data}. Повтор {repetitions_limit} раз'):\n            response = requests.post(url, headers=headers, data=data, verify=False)\n        while response.status_code == ResponseCodes.ok and i < repetitions_limit:\n            response = requests.post(url, headers=headers, data=data, verify=False)\n            i += 1\n    \n>       assert response.status_code == ResponseCodes.too_many_requests\nE       assert 200 == 429\nE        +  where 200 = <Response [200]>.status_code\nE        +  and   429 = ResponseCodes.too_many_requests\n\ntests\\test_chat_completions.py:189: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1761333245558,"stop":1761333245631,"duration":73},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Получаем токен авторизации","time":{"start":1761333245631,"stop":1761333245902,"duration":271},"status":"passed","steps":[{"name":"POST запрос к https://ngw.devices.sberbank.ru:9443/api/v2/oauth с данными scope=GIGACHAT_API_PERS","time":{"start":1761333245631,"stop":1761333245901,"duration":270},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert 200 == 429\n +  where 200 = <Response [200]>.status_code\n +  and   429 = ResponseCodes.too_many_requests","statusTrace":"self = <test_chat_completions.TestChatCompletions object at 0x0000021017422C50>\ntoken = 'eyJjdHkiOiJqd3QiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwiYWxnIjoiUlNBLU9BRVAtMjU2In0.DVdan-pSjNVHU09tBQ10KS3wxagR3aI7XP-fDm7bO...w_EBc1IrLoIIeAfZ4IwKzs4nYEVBDH8Mjw2zn8ucTJvU7Nbh1kGQbcEPJUd7BwCdqajahH39mw.xeqvBqC6U6RINPR59Ba2NoN_xxsZh-TuuVrufs5EgQk'\n\n    @allure.title('Получаем ошибку 429.')\n    def test_too_many_requests(self, token):\n        url = main_url + completions\n        data = json.dumps({\n            \"model\": RequestData.model,\n            \"messages\": [\n                {\n                \"role\": RequestData.role,\n                \"content\": RequestData.content\n                }\n            ],\n            \"temperature\": RequestData.temperature,\n            \"top_p\": RequestData.top_p,\n            \"stream\": RequestData.stream,\n            \"max_tokens\": RequestData.max_tokens,\n            \"repetition_penalty\": RequestData.repetition_penalty,\n            \"update_interval\": RequestData.update_interval\n        })\n        headers = {\n            'X-Client-ID': RequestData.x_client,\n            'X-Request-ID': RequestData.x_request,\n            'X-Session-ID': RequestData.x_session,\n            'Content-Type': RequestData.content_type,\n            'Authorization': \"Bearer \" + token\n            }\n    \n        i = 0\n        with allure.step(f'POST запрос к {url} с данными {data}. Повтор {repetitions_limit} раз'):\n            response = requests.post(url, headers=headers, data=data, verify=False)\n        while response.status_code == ResponseCodes.ok and i < repetitions_limit:\n            response = requests.post(url, headers=headers, data=data, verify=False)\n            i += 1\n    \n>       assert response.status_code == ResponseCodes.too_many_requests\nE       assert 200 == 429\nE        +  where 200 = <Response [200]>.status_code\nE        +  and   429 = ResponseCodes.too_many_requests\n\ntests\\test_chat_completions.py:189: AssertionError","steps":[{"name":"POST запрос к https://gigachat.devices.sberbank.ru/api/v1/chat/completions с данными {\"model\": \"GigaChat:1.0.26.20\", \"messages\": [{\"role\": \"user\", \"content\": \"\\u041f\\u043e\\u0433\\u043e\\u0434\\u0430 \\u0432 \\u041c\\u043e\\u0441\\u043a\\u0432\\u0435 \\u0432 \\u0431\\u043b\\u0438\\u0436\\u0430\\u0439\\u0448\\u0438\\u0435 \\u0442\\u0440\\u0438 \\u0434\\u043d\\u044f\"}], \"temperature\": 1, \"top_p\": 1, \"stream\": false, \"max_tokens\": 100, \"repetition_penalty\": 1, \"update_interval\": 0}. Повтор 100 раз","time":{"start":1761333247727,"stop":1761333248556,"duration":829},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_chat_completions"},{"name":"subSuite","value":"TestChatCompletions"},{"name":"host","value":"NIK-T14"},{"name":"thread","value":"17440-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_chat_completions"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":[]},"source":"b9e9a5e927509a56.json","parameterValues":[]}